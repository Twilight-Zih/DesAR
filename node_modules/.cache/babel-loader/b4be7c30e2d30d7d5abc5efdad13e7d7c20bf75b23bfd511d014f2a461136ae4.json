{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ZIHAB\\\\OneDrive\\\\Desktop\\\\Final Year Mesh&Zih\\\\DesAR\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from \"react\";\nimport \"./App.css\";\nimport * as THREE from \"three\";\nimport { ARButton } from \"three/examples/jsm/webxr/ARButton\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { XREstimatedLight } from \"three/examples/jsm/webxr/XREstimatedLight\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  // State to manage placement mode\n  const [isPlacementMode, setIsPlacementMode] = useState(false);\n\n  // References for mutable variables\n  const reticleRef = useRef();\n  const placedObjectsRef = useRef([]);\n  const itemsRef = useRef([]);\n  const controllerRef = useRef();\n  const raycasterRef = useRef(new THREE.Raycaster());\n  const doubleTapRef = useRef(0);\n  const isDraggingRef = useRef(false);\n  const selectedObjectRef = useRef(null);\n  const previousXRef = useRef(0);\n\n  // References for scene, camera, renderer\n  const sceneRef = useRef();\n  const cameraRef = useRef();\n  const rendererRef = useRef();\n\n  // Model paths and scale factors\n  const models = [\"./dylan_armchair_yolk_yellow.glb\", \"./ivan_armchair_mineral_blue.glb\", \"./marble_coffee_table.glb\", \"./flippa_functional_coffee_table_w._storagewalnut.glb\", \"./frame_armchairpetrol_velvet_with_gold_frame.glb\", \"./elnaz_nesting_side_tables_brass__green_marble.glb\"];\n  const modelScaleFactor = [0.01, 0.01, 0.005, 0.01, 0.01, 0.01];\n\n  // Initialize the scene\n  useEffect(() => {\n    init();\n    setupFurnitureSelection();\n    animate();\n\n    // Cleanup on unmount\n    return () => {\n      rendererRef.current.dispose();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Initialize function\n  const init = () => {\n    const myCanvas = document.getElementById(\"canvas\");\n    sceneRef.current = new THREE.Scene();\n    cameraRef.current = new THREE.PerspectiveCamera(70, myCanvas.clientWidth / myCanvas.clientHeight, 0.01, 20);\n\n    // Add hemisphere light\n    const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);\n    light.position.set(0.5, 1, 0.25);\n    sceneRef.current.add(light);\n\n    // Initialize renderer\n    rendererRef.current = new THREE.WebGLRenderer({\n      canvas: myCanvas,\n      antialias: true,\n      alpha: true\n    });\n    rendererRef.current.setPixelRatio(window.devicePixelRatio);\n    rendererRef.current.setSize(myCanvas.clientWidth, myCanvas.clientHeight);\n    rendererRef.current.xr.enabled = true;\n\n    // Add XR estimated light\n    const xrLight = new XREstimatedLight(rendererRef.current);\n    xrLight.addEventListener(\"estimationstart\", () => {\n      sceneRef.current.add(xrLight);\n      sceneRef.current.remove(light);\n      if (xrLight.environment) {\n        sceneRef.current.environment = xrLight.environment;\n      }\n    });\n    xrLight.addEventListener(\"estimationend\", () => {\n      sceneRef.current.add(light);\n      sceneRef.current.remove(xrLight);\n    });\n\n    // Add AR button\n    const arButton = ARButton.createButton(rendererRef.current, {\n      requiredFeatures: [\"hit-test\"],\n      optionalFeatures: [\"dom-overlay\", \"light-estimation\"],\n      domOverlay: {\n        root: document.body\n      }\n    });\n    arButton.style.bottom = \"20%\";\n    document.body.appendChild(arButton);\n\n    // Load all models\n    const loader = new GLTFLoader();\n    models.forEach((modelPath, index) => {\n      loader.load(modelPath, function (glb) {\n        const model = glb.scene;\n        model.traverse(child => {\n          if (child.isMesh) {\n            child.castShadow = true;\n            child.receiveShadow = true;\n          }\n        });\n        itemsRef.current[index] = model;\n        console.log(`Model loaded: ${modelPath}`);\n      }, undefined, function (error) {\n        console.error(`Error loading model ${modelPath}:`, error);\n      });\n    });\n\n    // Set up controller\n    controllerRef.current = rendererRef.current.xr.getController(0);\n    controllerRef.current.addEventListener(\"select\", onSelect);\n    sceneRef.current.add(controllerRef.current);\n\n    // Create reticle\n    reticleRef.current = new THREE.Mesh(new THREE.RingGeometry(0.15, 0.2, 32).rotateX(-Math.PI / 2), new THREE.MeshBasicMaterial({\n      color: 0x00ff00,\n      opacity: 0.75,\n      transparent: true\n    }));\n    reticleRef.current.matrixAutoUpdate = false;\n    reticleRef.current.visible = false;\n    sceneRef.current.add(reticleRef.current);\n\n    // Add event listeners for double-tap and dragging\n    window.addEventListener(\"touchstart\", onDoubleTap, false); // For mobile\n    window.addEventListener(\"mousedown\", onPointerDown, false); // For desktop\n    window.addEventListener(\"mousemove\", onPointerMove, false);\n    window.addEventListener(\"mouseup\", onPointerUp, false);\n\n    // Handle window resize\n    window.addEventListener(\"resize\", onWindowResize, false);\n  };\n\n  // Handle window resize\n  const onWindowResize = () => {\n    const myCanvas = document.getElementById(\"canvas\");\n    cameraRef.current.aspect = myCanvas.clientWidth / myCanvas.clientHeight;\n    cameraRef.current.updateProjectionMatrix();\n    rendererRef.current.setSize(myCanvas.clientWidth, myCanvas.clientHeight);\n    console.log(\"Window resized.\");\n  };\n\n  // Handle object selection for placement\n  const onSelect = () => {\n    if (isPlacementMode && reticleRef.current.visible && itemsRef.current[itemSelectedIndex]) {\n      const newModel = itemsRef.current[itemSelectedIndex].clone();\n      newModel.visible = true;\n      const newPosition = new THREE.Vector3();\n      const newQuaternion = new THREE.Quaternion();\n      const newScale = new THREE.Vector3();\n      reticleRef.current.matrix.decompose(newPosition, newQuaternion, newScale);\n\n      // Check for overlap with existing objects using bounding boxes\n      const newBox = new THREE.Box3().setFromObject(newModel);\n      newBox.translate(newPosition.clone().sub(newBox.getCenter(newBox.min)));\n      const overlap = placedObjectsRef.current.some(object => {\n        const existingBox = new THREE.Box3().setFromObject(object);\n        return existingBox.intersectsBox(newBox);\n      });\n      if (overlap) {\n        console.log(\"Cannot place object: overlap detected.\");\n        return;\n      }\n\n      // Place the object if there's no overlap\n      newModel.position.copy(newPosition);\n      newModel.quaternion.copy(newQuaternion);\n      const scaleFactor = modelScaleFactor[itemSelectedIndex];\n      newModel.scale.set(scaleFactor, scaleFactor, scaleFactor);\n      sceneRef.current.add(newModel);\n      placedObjectsRef.current.push(newModel); // Track placed objects\n      console.log(\"Object placed.\");\n\n      // Disable placement mode after placing\n      setIsPlacementMode(false);\n    }\n  };\n\n  // Handle furniture selection from navbar\n  const onClicked = (e, selectItem, index) => {\n    setIsPlacementMode(false); // Ensure placement mode is off when selecting a new item\n    itemSelectedIndex.current = index;\n\n    // Remove image selection from others to indicate unclicked\n    for (let i = 0; i < models.length; i++) {\n      const el = document.querySelector(`#item` + i);\n      if (el) {\n        el.classList.remove(\"clicked\");\n      }\n    }\n\n    // Set image to selected\n    if (e.target) {\n      e.target.classList.add(\"clicked\");\n      console.log(`Item selected: ${index}`);\n    }\n  };\n\n  // Reference to the currently selected item index\n  const itemSelectedIndex = useRef(0);\n\n  // Set up furniture selection event listeners\n  const setupFurnitureSelection = () => {\n    for (let i = 0; i < models.length; i++) {\n      const el = document.querySelector(`#item` + i);\n      if (el) {\n        el.addEventListener(\"beforexrselect\", e => {\n          e.preventDefault();\n          e.stopPropagation();\n        });\n        el.addEventListener(\"click\", e => {\n          e.preventDefault();\n          e.stopPropagation();\n          onClicked(e, itemsRef.current[i], i);\n        });\n      } else {\n        console.warn(`Element #item${i} not found in index.html.`);\n      }\n    }\n  };\n\n  // Handle double-tap for object removal\n  const onDoubleTap = event => {\n    const currentTime = new Date().getTime();\n    const tapLength = currentTime - doubleTapRef.current;\n    if (tapLength < 300 && tapLength > 0) {\n      // Double-tap detected\n      handleObjectRemoval(event);\n      event.preventDefault();\n    }\n    doubleTapRef.current = currentTime;\n  };\n\n  // Remove object based on tap/click position\n  const handleObjectRemoval = event => {\n    let touchX, touchY;\n    if (event.touches && event.touches.length > 0) {\n      touchX = event.touches[0].clientX;\n      touchY = event.touches[0].clientY;\n    } else {\n      // For desktop\n      touchX = event.clientX;\n      touchY = event.clientY;\n    }\n    const mouse = new THREE.Vector2();\n    mouse.x = touchX / window.innerWidth * 2 - 1;\n    mouse.y = -(touchY / window.innerHeight) * 2 + 1;\n    raycasterRef.current.setFromCamera(mouse, cameraRef.current);\n    const intersects = raycasterRef.current.intersectObjects(placedObjectsRef.current, true);\n    if (intersects.length > 0) {\n      const intersected = intersects[0].object;\n      const objectToRemove = findTopLevelParent(intersected);\n      if (objectToRemove) {\n        sceneRef.current.remove(objectToRemove);\n        placedObjectsRef.current = placedObjectsRef.current.filter(obj => obj !== objectToRemove);\n        console.log(\"Object removed on double-tap.\");\n      }\n    }\n  };\n\n  // Helper function to find the top-level parent in placedObjects\n  const findTopLevelParent = child => {\n    let parent = child;\n    while (parent.parent && parent.parent !== sceneRef.current) {\n      parent = parent.parent;\n    }\n    if (placedObjectsRef.current.includes(parent)) {\n      return parent;\n    }\n    return null;\n  };\n\n  // Handle pointer down event for dragging-based rotation\n  const onPointerDown = event => {\n    isDraggingRef.current = true;\n    previousXRef.current = event.clientX || event.touches && event.touches[0].clientX;\n    console.log(\"Dragging started.\");\n    const mouse = new THREE.Vector2();\n    if (event.touches && event.touches.length > 0) {\n      mouse.x = event.touches[0].clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;\n    } else {\n      mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n    }\n    raycasterRef.current.setFromCamera(mouse, cameraRef.current);\n    const intersects = raycasterRef.current.intersectObjects(placedObjectsRef.current, true);\n    if (intersects.length > 0) {\n      selectedObjectRef.current = findTopLevelParent(intersects[0].object);\n      if (selectedObjectRef.current) {\n        console.log(\"Object selected for rotation.\");\n      }\n    }\n  };\n\n  // Handle pointer move event for dragging-based rotation\n  const onPointerMove = event => {\n    if (isDraggingRef.current && selectedObjectRef.current) {\n      const currentX = event.clientX || event.touches && event.touches[0].clientX;\n      const deltaX = currentX - previousXRef.current;\n      const rotationSpeed = 0.005; // Adjust rotation speed as needed\n      selectedObjectRef.current.rotation.y += deltaX * rotationSpeed;\n      previousXRef.current = currentX;\n      // console.log(`Rotating object by deltaX: ${deltaX}`);\n    }\n  };\n\n  // Handle pointer up event to end dragging\n  const onPointerUp = () => {\n    if (isDraggingRef.current) {\n      isDraggingRef.current = false;\n      selectedObjectRef.current = null;\n      console.log(\"Dragging ended.\");\n    }\n  };\n\n  // Animation loop\n  const animate = () => {\n    rendererRef.current.setAnimationLoop(render);\n  };\n\n  // Render function\n  const render = (timestamp, frame) => {\n    if (frame) {\n      const referenceSpace = rendererRef.current.xr.getReferenceSpace();\n      const session = rendererRef.current.xr.getSession();\n      if (!reticleRef.current) return;\n      if (!reticleRef.current.hitTestSourceRequested) {\n        session.requestReferenceSpace(\"viewer\").then(function (referenceSpace) {\n          session.requestHitTestSource({\n            space: referenceSpace\n          }).then(function (source) {\n            reticleRef.current.hitTestSource = source;\n          });\n        }).catch(err => console.error(err));\n        session.addEventListener(\"end\", function () {\n          reticleRef.current.hitTestSourceRequested = false;\n          reticleRef.current.hitTestSource = null;\n        });\n        reticleRef.current.hitTestSourceRequested = true;\n      }\n      if (reticleRef.current.hitTestSource) {\n        const hitTestResults = frame.getHitTestResults(reticleRef.current.hitTestSource);\n        if (hitTestResults.length > 0) {\n          const hit = hitTestResults[0];\n          const hitPose = hit.getPose(referenceSpace);\n          const hitMatrix = new THREE.Matrix4().fromArray(hitPose.transform.matrix);\n\n          // Extract the normal vector from the hit matrix\n          const normal = new THREE.Vector3(0, 1, 0).applyQuaternion(new THREE.Quaternion().setFromRotationMatrix(hitMatrix));\n\n          // Define a threshold for how horizontal the plane should be\n          const horizontalThreshold = 0.6; // Adjust between 0 (vertical) to 1 (horizontal)\n\n          if (normal.y > horizontalThreshold) {\n            // The plane is sufficiently horizontal\n            reticleRef.current.visible = true;\n            reticleRef.current.matrix.fromArray(hitPose.transform.matrix);\n          } else {\n            // The plane is not horizontal; hide the reticle\n            reticleRef.current.visible = false;\n          }\n        } else {\n          reticleRef.current.visible = false;\n        }\n      }\n    }\n    rendererRef.current.render(sceneRef.current, cameraRef.current);\n  };\n\n  // Toggle placement mode when \"Place\" button is clicked\n  const togglePlacementMode = () => {\n    if (!itemSelectedIndex.current && itemsRef.current.length === 0) {\n      alert(\"Please select an item to place first.\");\n      return;\n    }\n    setIsPlacementMode(prev => !prev);\n    console.log(`Placement mode: ${!isPlacementMode}`);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"place-button\",\n      onClick: togglePlacementMode,\n      children: isPlacementMode ? \"Cancel Placement\" : \"Place\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 424,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"fY0XsbvdbRUEIOFI5kvzusTX1GI=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useRef","useEffect","THREE","ARButton","GLTFLoader","XREstimatedLight","jsxDEV","_jsxDEV","App","_s","isPlacementMode","setIsPlacementMode","reticleRef","placedObjectsRef","itemsRef","controllerRef","raycasterRef","Raycaster","doubleTapRef","isDraggingRef","selectedObjectRef","previousXRef","sceneRef","cameraRef","rendererRef","models","modelScaleFactor","init","setupFurnitureSelection","animate","current","dispose","myCanvas","document","getElementById","Scene","PerspectiveCamera","clientWidth","clientHeight","light","HemisphereLight","position","set","add","WebGLRenderer","canvas","antialias","alpha","setPixelRatio","window","devicePixelRatio","setSize","xr","enabled","xrLight","addEventListener","remove","environment","arButton","createButton","requiredFeatures","optionalFeatures","domOverlay","root","body","style","bottom","appendChild","loader","forEach","modelPath","index","load","glb","model","scene","traverse","child","isMesh","castShadow","receiveShadow","console","log","undefined","error","getController","onSelect","Mesh","RingGeometry","rotateX","Math","PI","MeshBasicMaterial","color","opacity","transparent","matrixAutoUpdate","visible","onDoubleTap","onPointerDown","onPointerMove","onPointerUp","onWindowResize","aspect","updateProjectionMatrix","itemSelectedIndex","newModel","clone","newPosition","Vector3","newQuaternion","Quaternion","newScale","matrix","decompose","newBox","Box3","setFromObject","translate","sub","getCenter","min","overlap","some","object","existingBox","intersectsBox","copy","quaternion","scaleFactor","scale","push","onClicked","e","selectItem","i","length","el","querySelector","classList","target","preventDefault","stopPropagation","warn","event","currentTime","Date","getTime","tapLength","handleObjectRemoval","touchX","touchY","touches","clientX","clientY","mouse","Vector2","x","innerWidth","y","innerHeight","setFromCamera","intersects","intersectObjects","intersected","objectToRemove","findTopLevelParent","filter","obj","parent","includes","currentX","deltaX","rotationSpeed","rotation","setAnimationLoop","render","timestamp","frame","referenceSpace","getReferenceSpace","session","getSession","hitTestSourceRequested","requestReferenceSpace","then","requestHitTestSource","space","source","hitTestSource","catch","err","hitTestResults","getHitTestResults","hit","hitPose","getPose","hitMatrix","Matrix4","fromArray","transform","normal","applyQuaternion","setFromRotationMatrix","horizontalThreshold","togglePlacementMode","alert","prev","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/ZIHAB/OneDrive/Desktop/Final Year Mesh&Zih/DesAR/src/App.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport \"./App.css\";\nimport * as THREE from \"three\";\nimport { ARButton } from \"three/examples/jsm/webxr/ARButton\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { XREstimatedLight } from \"three/examples/jsm/webxr/XREstimatedLight\";\n\nfunction App() {\n  // State to manage placement mode\n  const [isPlacementMode, setIsPlacementMode] = useState(false);\n\n  // References for mutable variables\n  const reticleRef = useRef();\n  const placedObjectsRef = useRef([]);\n  const itemsRef = useRef([]);\n  const controllerRef = useRef();\n  const raycasterRef = useRef(new THREE.Raycaster());\n  const doubleTapRef = useRef(0);\n  const isDraggingRef = useRef(false);\n  const selectedObjectRef = useRef(null);\n  const previousXRef = useRef(0);\n\n  // References for scene, camera, renderer\n  const sceneRef = useRef();\n  const cameraRef = useRef();\n  const rendererRef = useRef();\n\n  // Model paths and scale factors\n  const models = [\n    \"./dylan_armchair_yolk_yellow.glb\",\n    \"./ivan_armchair_mineral_blue.glb\",\n    \"./marble_coffee_table.glb\",\n    \"./flippa_functional_coffee_table_w._storagewalnut.glb\",\n    \"./frame_armchairpetrol_velvet_with_gold_frame.glb\",\n    \"./elnaz_nesting_side_tables_brass__green_marble.glb\",\n  ];\n  const modelScaleFactor = [0.01, 0.01, 0.005, 0.01, 0.01, 0.01];\n\n  // Initialize the scene\n  useEffect(() => {\n    init();\n    setupFurnitureSelection();\n    animate();\n\n    // Cleanup on unmount\n    return () => {\n      rendererRef.current.dispose();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Initialize function\n  const init = () => {\n    const myCanvas = document.getElementById(\"canvas\");\n    sceneRef.current = new THREE.Scene();\n    cameraRef.current = new THREE.PerspectiveCamera(\n      70,\n      myCanvas.clientWidth / myCanvas.clientHeight,\n      0.01,\n      20\n    );\n\n    // Add hemisphere light\n    const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);\n    light.position.set(0.5, 1, 0.25);\n    sceneRef.current.add(light);\n\n    // Initialize renderer\n    rendererRef.current = new THREE.WebGLRenderer({\n      canvas: myCanvas,\n      antialias: true,\n      alpha: true,\n    });\n    rendererRef.current.setPixelRatio(window.devicePixelRatio);\n    rendererRef.current.setSize(myCanvas.clientWidth, myCanvas.clientHeight);\n    rendererRef.current.xr.enabled = true;\n\n    // Add XR estimated light\n    const xrLight = new XREstimatedLight(rendererRef.current);\n    xrLight.addEventListener(\"estimationstart\", () => {\n      sceneRef.current.add(xrLight);\n      sceneRef.current.remove(light);\n      if (xrLight.environment) {\n        sceneRef.current.environment = xrLight.environment;\n      }\n    });\n\n    xrLight.addEventListener(\"estimationend\", () => {\n      sceneRef.current.add(light);\n      sceneRef.current.remove(xrLight);\n    });\n\n    // Add AR button\n    const arButton = ARButton.createButton(rendererRef.current, {\n      requiredFeatures: [\"hit-test\"],\n      optionalFeatures: [\"dom-overlay\", \"light-estimation\"],\n      domOverlay: { root: document.body },\n    });\n    arButton.style.bottom = \"20%\";\n    document.body.appendChild(arButton);\n\n    // Load all models\n    const loader = new GLTFLoader();\n    models.forEach((modelPath, index) => {\n      loader.load(\n        modelPath,\n        function (glb) {\n          const model = glb.scene;\n          model.traverse((child) => {\n            if (child.isMesh) {\n              child.castShadow = true;\n              child.receiveShadow = true;\n            }\n          });\n          itemsRef.current[index] = model;\n          console.log(`Model loaded: ${modelPath}`);\n        },\n        undefined,\n        function (error) {\n          console.error(`Error loading model ${modelPath}:`, error);\n        }\n      );\n    });\n\n    // Set up controller\n    controllerRef.current = rendererRef.current.xr.getController(0);\n    controllerRef.current.addEventListener(\"select\", onSelect);\n    sceneRef.current.add(controllerRef.current);\n\n    // Create reticle\n    reticleRef.current = new THREE.Mesh(\n      new THREE.RingGeometry(0.15, 0.2, 32).rotateX(-Math.PI / 2),\n      new THREE.MeshBasicMaterial({\n        color: 0x00ff00,\n        opacity: 0.75,\n        transparent: true,\n      })\n    );\n    reticleRef.current.matrixAutoUpdate = false;\n    reticleRef.current.visible = false;\n    sceneRef.current.add(reticleRef.current);\n\n    // Add event listeners for double-tap and dragging\n    window.addEventListener(\"touchstart\", onDoubleTap, false); // For mobile\n    window.addEventListener(\"mousedown\", onPointerDown, false); // For desktop\n    window.addEventListener(\"mousemove\", onPointerMove, false);\n    window.addEventListener(\"mouseup\", onPointerUp, false);\n\n    // Handle window resize\n    window.addEventListener(\"resize\", onWindowResize, false);\n  };\n\n  // Handle window resize\n  const onWindowResize = () => {\n    const myCanvas = document.getElementById(\"canvas\");\n    cameraRef.current.aspect = myCanvas.clientWidth / myCanvas.clientHeight;\n    cameraRef.current.updateProjectionMatrix();\n    rendererRef.current.setSize(myCanvas.clientWidth, myCanvas.clientHeight);\n    console.log(\"Window resized.\");\n  };\n\n  // Handle object selection for placement\n  const onSelect = () => {\n    if (isPlacementMode && reticleRef.current.visible && itemsRef.current[itemSelectedIndex]) {\n      const newModel = itemsRef.current[itemSelectedIndex].clone();\n      newModel.visible = true;\n\n      const newPosition = new THREE.Vector3();\n      const newQuaternion = new THREE.Quaternion();\n      const newScale = new THREE.Vector3();\n      reticleRef.current.matrix.decompose(newPosition, newQuaternion, newScale);\n\n      // Check for overlap with existing objects using bounding boxes\n      const newBox = new THREE.Box3().setFromObject(newModel);\n      newBox.translate(newPosition.clone().sub(newBox.getCenter(newBox.min)));\n\n      const overlap = placedObjectsRef.current.some((object) => {\n        const existingBox = new THREE.Box3().setFromObject(object);\n        return existingBox.intersectsBox(newBox);\n      });\n\n      if (overlap) {\n        console.log(\"Cannot place object: overlap detected.\");\n        return;\n      }\n\n      // Place the object if there's no overlap\n      newModel.position.copy(newPosition);\n      newModel.quaternion.copy(newQuaternion);\n      const scaleFactor = modelScaleFactor[itemSelectedIndex];\n      newModel.scale.set(scaleFactor, scaleFactor, scaleFactor);\n\n      sceneRef.current.add(newModel);\n      placedObjectsRef.current.push(newModel); // Track placed objects\n      console.log(\"Object placed.\");\n\n      // Disable placement mode after placing\n      setIsPlacementMode(false);\n    }\n  };\n\n  // Handle furniture selection from navbar\n  const onClicked = (e, selectItem, index) => {\n    setIsPlacementMode(false); // Ensure placement mode is off when selecting a new item\n    itemSelectedIndex.current = index;\n\n    // Remove image selection from others to indicate unclicked\n    for (let i = 0; i < models.length; i++) {\n      const el = document.querySelector(`#item` + i);\n      if (el) {\n        el.classList.remove(\"clicked\");\n      }\n    }\n\n    // Set image to selected\n    if (e.target) {\n      e.target.classList.add(\"clicked\");\n      console.log(`Item selected: ${index}`);\n    }\n  };\n\n  // Reference to the currently selected item index\n  const itemSelectedIndex = useRef(0);\n\n  // Set up furniture selection event listeners\n  const setupFurnitureSelection = () => {\n    for (let i = 0; i < models.length; i++) {\n      const el = document.querySelector(`#item` + i);\n      if (el) {\n        el.addEventListener(\"beforexrselect\", (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n        });\n        el.addEventListener(\"click\", (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          onClicked(e, itemsRef.current[i], i);\n        });\n      } else {\n        console.warn(`Element #item${i} not found in index.html.`);\n      }\n    }\n  };\n\n  // Handle double-tap for object removal\n  const onDoubleTap = (event) => {\n    const currentTime = new Date().getTime();\n    const tapLength = currentTime - doubleTapRef.current;\n    if (tapLength < 300 && tapLength > 0) {\n      // Double-tap detected\n      handleObjectRemoval(event);\n      event.preventDefault();\n    }\n    doubleTapRef.current = currentTime;\n  };\n\n  // Remove object based on tap/click position\n  const handleObjectRemoval = (event) => {\n    let touchX, touchY;\n    if (event.touches && event.touches.length > 0) {\n      touchX = event.touches[0].clientX;\n      touchY = event.touches[0].clientY;\n    } else {\n      // For desktop\n      touchX = event.clientX;\n      touchY = event.clientY;\n    }\n\n    const mouse = new THREE.Vector2();\n    mouse.x = (touchX / window.innerWidth) * 2 - 1;\n    mouse.y = -(touchY / window.innerHeight) * 2 + 1;\n\n    raycasterRef.current.setFromCamera(mouse, cameraRef.current);\n    const intersects = raycasterRef.current.intersectObjects(placedObjectsRef.current, true);\n\n    if (intersects.length > 0) {\n      const intersected = intersects[0].object;\n      const objectToRemove = findTopLevelParent(intersected);\n      if (objectToRemove) {\n        sceneRef.current.remove(objectToRemove);\n        placedObjectsRef.current = placedObjectsRef.current.filter((obj) => obj !== objectToRemove);\n        console.log(\"Object removed on double-tap.\");\n      }\n    }\n  };\n\n  // Helper function to find the top-level parent in placedObjects\n  const findTopLevelParent = (child) => {\n    let parent = child;\n    while (parent.parent && parent.parent !== sceneRef.current) {\n      parent = parent.parent;\n    }\n    if (placedObjectsRef.current.includes(parent)) {\n      return parent;\n    }\n    return null;\n  };\n\n  // Handle pointer down event for dragging-based rotation\n  const onPointerDown = (event) => {\n    isDraggingRef.current = true;\n    previousXRef.current = event.clientX || (event.touches && event.touches[0].clientX);\n    console.log(\"Dragging started.\");\n\n    const mouse = new THREE.Vector2();\n    if (event.touches && event.touches.length > 0) {\n      mouse.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1;\n      mouse.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;\n    } else {\n      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n    }\n\n    raycasterRef.current.setFromCamera(mouse, cameraRef.current);\n    const intersects = raycasterRef.current.intersectObjects(placedObjectsRef.current, true);\n\n    if (intersects.length > 0) {\n      selectedObjectRef.current = findTopLevelParent(intersects[0].object);\n      if (selectedObjectRef.current) {\n        console.log(\"Object selected for rotation.\");\n      }\n    }\n  };\n\n  // Handle pointer move event for dragging-based rotation\n  const onPointerMove = (event) => {\n    if (isDraggingRef.current && selectedObjectRef.current) {\n      const currentX = event.clientX || (event.touches && event.touches[0].clientX);\n      const deltaX = currentX - previousXRef.current;\n      const rotationSpeed = 0.005; // Adjust rotation speed as needed\n      selectedObjectRef.current.rotation.y += deltaX * rotationSpeed;\n\n      previousXRef.current = currentX;\n      // console.log(`Rotating object by deltaX: ${deltaX}`);\n    }\n  };\n\n  // Handle pointer up event to end dragging\n  const onPointerUp = () => {\n    if (isDraggingRef.current) {\n      isDraggingRef.current = false;\n      selectedObjectRef.current = null;\n      console.log(\"Dragging ended.\");\n    }\n  };\n\n  // Animation loop\n  const animate = () => {\n    rendererRef.current.setAnimationLoop(render);\n  };\n\n  // Render function\n  const render = (timestamp, frame) => {\n    if (frame) {\n      const referenceSpace = rendererRef.current.xr.getReferenceSpace();\n      const session = rendererRef.current.xr.getSession();\n\n      if (!reticleRef.current) return;\n\n      if (!reticleRef.current.hitTestSourceRequested) {\n        session\n          .requestReferenceSpace(\"viewer\")\n          .then(function (referenceSpace) {\n            session\n              .requestHitTestSource({ space: referenceSpace })\n              .then(function (source) {\n                reticleRef.current.hitTestSource = source;\n              });\n          })\n          .catch((err) => console.error(err));\n\n        session.addEventListener(\"end\", function () {\n          reticleRef.current.hitTestSourceRequested = false;\n          reticleRef.current.hitTestSource = null;\n        });\n\n        reticleRef.current.hitTestSourceRequested = true;\n      }\n\n      if (reticleRef.current.hitTestSource) {\n        const hitTestResults = frame.getHitTestResults(reticleRef.current.hitTestSource);\n\n        if (hitTestResults.length > 0) {\n          const hit = hitTestResults[0];\n          const hitPose = hit.getPose(referenceSpace);\n          const hitMatrix = new THREE.Matrix4().fromArray(hitPose.transform.matrix);\n\n          // Extract the normal vector from the hit matrix\n          const normal = new THREE.Vector3(0, 1, 0).applyQuaternion(\n            new THREE.Quaternion().setFromRotationMatrix(hitMatrix)\n          );\n\n          // Define a threshold for how horizontal the plane should be\n          const horizontalThreshold = 0.6; // Adjust between 0 (vertical) to 1 (horizontal)\n\n          if (normal.y > horizontalThreshold) {\n            // The plane is sufficiently horizontal\n            reticleRef.current.visible = true;\n            reticleRef.current.matrix.fromArray(hitPose.transform.matrix);\n          } else {\n            // The plane is not horizontal; hide the reticle\n            reticleRef.current.visible = false;\n          }\n        } else {\n          reticleRef.current.visible = false;\n        }\n      }\n    }\n\n    rendererRef.current.render(sceneRef.current, cameraRef.current);\n  };\n\n  // Toggle placement mode when \"Place\" button is clicked\n  const togglePlacementMode = () => {\n    if (!itemSelectedIndex.current && itemsRef.current.length === 0) {\n      alert(\"Please select an item to place first.\");\n      return;\n    }\n    setIsPlacementMode((prev) => !prev);\n    console.log(`Placement mode: ${!isPlacementMode}`);\n  };\n\n  return (\n    <div className=\"App\">\n      {/* Place Button */}\n      <button className=\"place-button\" onClick={togglePlacementMode}>\n        {isPlacementMode ? \"Cancel Placement\" : \"Place\"}\n      </button>\n      {/* You can style and position this button as needed */}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}